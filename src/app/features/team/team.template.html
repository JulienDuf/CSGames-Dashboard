<h1>{{ "pages.team.team" | translate }}</h1>
<app-loading-spinner [loading]="loading$ | async">
</app-loading-spinner>
<ng-container *ngIf="error$ | async">
    <div style="text-align: center">
        <i class="far fa-times-circle error fa-8x"></i>
        <h5>{{ "pages.team.loading_error" | translate }}</h5>
    </div>
</ng-container>
<ng-container *ngIf="currentTeam$ | async as currentTeam">
    <div *ngIf="!isEditingTeamName">
        <h2>{{ currentTeam?.name}}
            <button *ifRole="['admin', 'captain']" type="button" class="btn edit-name-button">
                <i class="far fa-edit fa-lg" (click)="onEditTeamName(currentTeam)"></i>
            </button>
        </h2>
    </div>
    <div *ngIf="isEditingTeamName">
        <div class="input-group input-group-default input" id="teamNameInput">
            <input class="form-control" type="text" id="teamName" [(ngModel)]="teamName">
        </div>
        <button type="button" class="btn btn-primary btn-save" (click)="onSaveTeamName(teamName)">
            {{ "general.button.save" | translate }}<i class="fas fa-check"></i>
        </button>
        <button type="button" class="btn btn-danger"
                (click)="onCancelTeamName(teamName)">
            {{ "general.button.cancel" | translate }} <i class="fas fa-times"></i>
        </button>
    </div>
    <ng-container *ngIf="currentAttendees$ | async as currentAttendees">
        <h4 class="team-members">{{ "pages.team.team_members" | translate }}
            <b>
                <a *ngIf="currentTeam?.maxMembersNumber === 11"> ({{ currentAttendees?.length }}/10)</a>
                <a *ngIf="currentTeam?.maxMembersNumber !== 11">
                    ({{ currentAttendees?.length }}/{{ currentTeam?.maxMembersNumber - 1 }})
                </a>
            </b>
        </h4>
        <hr>
        <div *ngFor="let member of currentAttendees">
            <app-attendee style="margin-bottom:20px;" [attendee]="member">
            </app-attendee>
        </div>
        <div *ifRole="['admin', 'captain']">
            <button *ngIf="!isAddingTeamMember &&
            (currentTeam?.attendees?.length < currentTeam?.maxMembersNumber && currentTeam?.maxMembersNumber !== 11 || 
            currentTeam?.attendees?.length < 10 && currentTeam?.maxMembersNumber === 11)"
                    type="button" class="btn btn-lg btn-block borders" (click)="onEditTeamMember()">
                + {{ "pages.team.add_member" | translate }}
            </button>
        </div>
    </ng-container>

    <div *ngIf="isAddingTeamMember" class="card-wrapper">
        <div class="add-member-card">
            <div class="card-body">
                {{ "pages.team.add_a_member" | translate }}
                <br>
                <div class="input-group input-group-default input">
                    <input class="form-control" type="text" id="firstNameAttendee"
                           placeholder='{{ "general.profile.first_name" | translate }}'
                           [(ngModel)]="newAttendee.firstName">
                </div>
                <div class="input-group input-group-default input">
                    <input class="form-control" type="text" id="lastNameAttendee"
                           placeholder='{{ "general.profile.last_name" | translate }}'
                           [(ngModel)]="newAttendee.lastName">
                </div>
                <br>
                <div class="input-group input-group-default input email">
                    <input class="form-control" type="text" id="emailAttendee"
                           placeholder='{{ "general.profile.email" | translate }}'
                           [(ngModel)]="newAttendee.email">
                </div>
                <a class="btn btn-primary" (click)="onAddTeamMember(newAttendee)">
                    {{ "general.button.add" | translate }} <i class="fas fa-plus"></i>
                </a>
                <a class="btn btn-danger cancel" (click)="onCancelTeamMember()">
                    {{ "general.button.cancel" | translate }}<i class="fas fa-times"></i>
                </a>
            </div>
        </div>
    </div>
    <ng-container *ngIf="currentGodparent$ | async as currentGodparent">
        <h4 class="team-members">{{ "pages.team.godparent" | translate }} <b>({{currentGodparent?.length}}/1)</b></h4>
        <hr>
        <div *ngFor="let member of currentGodparent">
            <app-attendee style="margin-bottom:20px;" [attendee]="member">
            </app-attendee>
        </div>
        <div *ifRole="['admin', 'captain']">
            <button *ngIf="!isAddingTeamGodparent && currentGodparent?.length < 1" type="button"
                    class="btn btn-lg btn-block borders"
                    (click)="onEditTeamGodparent()">+ {{ "pages.team.add_godparent" | translate }}</button>
        </div>
        <div *ngIf="isAddingTeamGodparent" class="card-wrapper">
            <div class="add-member-card">
                <div class="card-body">
                    {{ "pages.team.add_a_godparent" | translate }}
                    <br>
                    <div class="input-group input-group-default input">
                        <input class="form-control" type="text" id="firstNameGodparent"
                               placeholder='{{ "general.profile.first_name" | translate }}'
                               [(ngModel)]="newGodparent.firstName">
                    </div>
                    <div class="input-group input-group-default input">
                        <input class="form-control" type="text" id="lastNameGodparent"
                               placeholder='{{ "general.profile.last_name" | translate }}'
                               [(ngModel)]="newGodparent.lastName">
                    </div>
                    <br>
                    <div class="input-group input-group-default input email">
                        <input class="form-control" type="text" id="emailGodparent"
                               placeholder='{{ "general.profile.email" | translate }}'
                               [(ngModel)]="newGodparent.email">
                    </div>
                    <a class="btn btn-primary" (click)="onAddTeamGodparent(newGodparent)">
                        {{ "general.button.add" | translate }} <i class="fas fa-plus"></i>
                    </a>
                    <a class="btn btn-danger cancel" (click)="onCancelTeamGodparent()">
                        {{ "general.button.cancel" | translate }} <i class="fas fa-times"></i>
                    </a>

                </div>
            </div>
        </div>
        <div *ifRole="['attendee']">
            <div
                *ngIf="currentGodparent.length < 1 || (currentGodparent?.length < 1 && currentTeam?.maxMembersNumber === 11)"
                class="no-godparent">
                {{ "pages.team.no_godparent" | translate }}
            </div>
        </div>
    </ng-container>
</ng-container>
